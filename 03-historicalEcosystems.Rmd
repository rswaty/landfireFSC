# Historical Ecosystems {#historicalEcosystems}

## First Question: how many acres (what percent) of each ecosystem were in the area of interest historically?

For the next few questions we will work in a Pivot Table.  To get started  copy the entire "clean" sheet, click "Insert" at in the Excel ribbon then click "Pivot Table".  Once your pivot table is created you can start to explore.

1. In the Pivot Table Fields pane, select BpS Name then acres.  
2. Right click in the top "Sum of ACRES" field (not the table header), then sort in descending order.
3. In our example we have some BpSs that have low ACRES values.  We also have categories that are not meaningful, such as "Barren-Rock/Sand/Clay".  We can do a little formatting/cleaning before making a chart:
    * To remove BpSs from the table you will click the drop-down menu to the right of "BPS_NAME" in the Pivot Table Fields pane.  You can uncheck BpSs as appropriate.
    * It is also possible to filter by right clicking on the top value in the list of BpSs, then selecting Filter > Top 10....  Once in that menu you can refine the filtering.
4. To get percentages, drag "ACRES" from the top Pivot Table Field pane to the "Values" pane.  This will add a second "ACRES" column to the table.  Click the drop down in the second instance of "ACRES" (reads "SUM of ACRES2" in our example), then Value Field Settings.  In this menu select the "Show Values As" tab, click the "Show Values As" drop down then select "% of Grand Total% to get percentages of each BpS (make sure that "BPS_NAME" is selected as the "Base field").  
5.  To get a "running total" of percentages you will add a third instance of "ACRES" to the "Values" pane, then Value Field Settings.  In this menu select the "Show Values As" tab, click the "Show Values As" drop down then select "% Running Total In" to get running totals of  percentages of each BpS (make sure that "BPS_NAME" is selected as the "Base field"). 
6. Save and keep this pivot table as is for now.  We will make a couple modifications in the next section to get at a different question.

Formatted table of BpSs:

```{r bpsDT, echo=FALSE, message=FALSE, warning=FALSE}
library(DT)
library(readr)
bps <- read_csv("bps.csv")


datatable(head(bps), 
          class = 'cell-border stripe',
          options = list(scrollX  = TRUE, pageLength = 3))
```

<br>
<br>

We see that the top 4 BpSs comprised ~80% of our example landscape historically.  We can visually confirm this and other patterns with a quick chart made in R (though similar charts available in Excel):

<br>

```{r bpsChart, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(scales)

ggplot(bps, aes(x = reorder(BpS, ACRES), y = ACRES)) + 
  geom_bar(stat = "identity", fill = "grey31") +
  coord_flip() +
  labs(x = "", 
       y = "Acres", 
       title = "Historical Ecosystems",
       subtitle = "Names cleaned for clarity",
       caption = "From LANDFIRE Biophysical Settings data",
       colour = "black") +
  scale_y_continuous(labels = comma) +
theme(plot.title = element_text(size = 15), axis.title = element_text(size = 13), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black")) +
    theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot")
```


<br>

## Second question: how much of the historic ecosystems have been converted to a different land use (e.g., agriculture), or have succeeded to a different ecosystem?

If you are new to Pivot Tables this next section will 1) demonstrate their power and 2) showcase ways they can mislead!  

Working in the Pivot Table from before (or you can create a new one if you prefer):

1. Check the box next to "EVT_NAME" in the Pivot Table Fields pane.  Make sure that everything is arranged as in the screenshot below (e.g., "BPS_NAME" is on top of "EVT_NAME" in the "Rows" pane).  Note-I am about to sort in descending order.

<br>

```{r, echo=FALSE, out.width='100%'} 
knitr::include_graphics("pivotBpsEvt.png")

```

<br>

2. Review the results. In the example above we can see that what LANDFIRE mapped as Laurentian-Acadian Forest-Hemlock in the BpS data set has been split into many Existing Vegetation Types.  If ordered we get a little more information, but the numbers are misleading.  We'd like to see how much of what was Ecosystem X is still Ecosystem X, and how much is now Ecosystem Y, and so on, but the numbers are looking across the whole landscape.  They need to be recalculated so we get the percentage of EVT per BpS.
3. To reconfigure the Pivot Table:
    * Drag the "Sum of ACRES2" and "Sum of ACRES3" field from the "Values" pane up to the Pivot Table Fields to remove it.
    * Click the "Sum of ACRES" item in the "Values" pane to access the Value field settings.
    * Click on the "Show Values As" tab, then select "% of Parent Row Total" in the "Show Values As" drop down.  
    
Here's a screenshot of making that selection:

<br>

```{r, echo=FALSE, out.width='100%'} 
knitr::include_graphics("pivotPercentParent.png")

```

<br>

You'll see that ~34% of what was classified as "Boreal Acidic Peatland Systems" in the BpS dataset for our landscape is now classified as "Boreal-Laurentian Conifer Acidic Swamp and Treed Poor Fen" in the Existing Vegetation Type dataset.    Scroll through the table below to explore the resulting data.  The table has been exported from the Pivot Table and cleaned up a bit for viewing.  

**Note: I filtered for the Top 10 EVTs per BpS.** 

<br>

```{r bpsEvtDT, echo=FALSE, message=FALSE, warning=FALSE}
library(DT)
library(readr)
bpsEvt <- read_csv("bpsEvt.csv")


datatable((bpsEvt), 
          class = 'cell-border stripe',
          options = list(scrollX  = TRUE, 
                         pageLength = 5, scrollY = "400px"))
```

<br>
<br>

Looking at the Laurentian-Acadian Northern Hardwoods Forest - Hemlock for our landscape we note a few things:

* Most of what was mapped as this type historically in the BpS dataset is still mapped as that type
* Cumulatively about 6% of this type is now roads and recently logged types.
* The other EVTs mapped are not terribly "off-site" (e.g., something like "Plantation").  

**The fine print**
While this assessment is illustrative, it is important to note that the methods used to create the BpS and EVT datasets are substantially different, and LANDFIRE datasets are not made for assessing small areas.  Please review.









